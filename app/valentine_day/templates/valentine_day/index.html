{%load static%}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Comic+Relief:wght@400;700&family=Love+Ya+Like+A+Sister&family=Mukta:wght@200;300;400;500;600;700;800&family=Noto+Serif+Dives+Akuru&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@12/swiper-bundle.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://code.jquery.com/jquery-4.0.0.min.js" integrity="sha256-OaVG6prZf4v69dPg6PhVattBXkcOWQB62pdZ3ORyrao=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{%static 'valentine_day/css/styles.css' %}?v=27">
    <link rel="stylesheet" href="{%static 'valentine_day/css/screens.css'%}?v=27">
    <script src="{%static 'valentine_day/js/main.js'%}?v=29"></script>
</head>

<body>
    <div id="pre-load-screen">
        <div class="heart"></div>
    </div>
    <div id="main-screen" style="display: none;">
        <header class="container">
            <i class="fa-regular fa-circle-question" data-screen-go="about"></i>
            <span></span>
            <i class="fa-solid fa-envelope" id="my-messages" data-screen-go="received-valentines-list"></i>
        </header>
        <main>
            <img src="{%static 'valentine_day/img/main.png'%}" alt="" style="width: 100%;">
            <div class="button-wrapper">
                <button id="start-button" class="main-btn">–í—ã–±—Ä–∞—Ç—å —Å–≤–æ—é <br>–ª—é –±–≤–∏–Ω–∫—É</button>
                <button id="open-my-valentines" class="main-btn">–ú–æ–∏ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏</button>
            </div>
        </main>
        <footer>

        </footer>
    </div>
    <div id="about" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="main"></i>
        </header>
        <div class="container">
            <h2>–û –¥–Ω–µ –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞</h2>
            <img src="{%static 'valentine_day/img/about.webp'%}" alt="" class="w-full">
            <p><b>–î–µ–Ω—å —Å–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞</b> ‚Äî —ç—Ç–æ –ø—Ä–∞–∑–¥–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–º–µ—á–∞–µ—Ç—Å—è 14 —Ñ–µ–≤—Ä–∞–ª—è –∏ –ø–æ—Å–≤—è—â—ë–Ω –ª—é–±–≤–∏, —Å–∏–º–ø–∞—Ç–∏–∏ –∏ —Ç—ë–ø–ª—ã–º —á—É–≤—Å—Ç–≤–∞–º –º–µ–∂–¥—É –ª—é–¥—å–º–∏. –ï–≥–æ –∏—Å—Ç–æ—Ä–∏—è —É—Ö–æ–¥–∏—Ç –∫–æ—Ä–Ω—è–º–∏ –≤ –î—Ä–µ–≤–Ω–∏–π –†–∏–º –∏ —Å–≤—è–∑–∞–Ω–∞
                —Å –ª–µ–≥–µ–Ω–¥–æ–π –æ —Å–≤—è—Ç–æ–º –í–∞–ª–µ–Ω—Ç–∏–Ω–µ ‚Äî —Å–≤—è—â–µ–Ω–Ω–∏–∫–µ, –∫–æ—Ç–æ—Ä—ã–π, –ø–æ –ø—Ä–µ–¥–∞–Ω–∏—é, —Ç–∞–π–Ω–æ –≤–µ–Ω—á–∞–ª –≤–ª—é–±–ª—ë–Ω–Ω—ã–µ –ø–∞—Ä—ã, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∑–∞–ø—Ä–µ—Ç—ã –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞. –ó–∞ —ç—Ç–æ –æ–Ω –±—ã–ª –∫–∞–∑–Ω—ë–Ω, –∞ –ø–æ–∑–∂–µ –∫–∞–Ω–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω.</p>
            <p>–°–æ –≤—Ä–µ–º–µ–Ω–µ–º –ø—Ä–∞–∑–¥–Ω–∏–∫ —É—Ç—Ä–∞—Ç–∏–ª —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ —Å—Ç–∞–ª —Å–≤–µ—Ç—Å–∫–∏–º. –°–µ–≥–æ–¥–Ω—è –î–µ–Ω—å —Å–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ ‚Äî —ç—Ç–æ –ø–æ–≤–æ–¥ –≤—ã—Ä–∞–∑–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –∏ –∑–∞–±–æ—Ç—É –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–º—É –ø–∞—Ä—Ç–Ω—ë—Ä—É, –Ω–æ –∏ –¥—Ä—É–∑—å—è–º,
                –∫–æ–ª–ª–µ–≥–∞–º –∏–ª–∏ –±–ª–∏–∑–∫–∏–º –ª—é–¥—è–º. –¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è —Å–µ—Ä–¥–µ—á–∫–∏, —Ü–≤–µ—Ç—ã, –æ—Ç–∫—Ä—ã—Ç–∫–∏-¬´–≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏¬ª –∏ –Ω–µ–±–æ–ª—å—à–∏–µ –ø–æ–¥–∞—Ä–∫–∏.</p>
            <p>–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è —ç—Ç–æ–≥–æ –¥–Ω—è ‚Äî –Ω–∞–ø–æ–º–Ω–∏—Ç—å –æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –∏—Å–∫—Ä–µ–Ω–Ω–∏—Ö —á—É–≤—Å—Ç–≤, –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –¥–æ–±—Ä—ã—Ö —Å–ª–æ–≤. –î–∞–∂–µ –ø—Ä–æ—Å—Ç–æ–π –∂–µ—Å—Ç –≤–Ω–∏–º–∞–Ω–∏—è –º–æ–∂–µ—Ç –ø–æ–¥–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Å–¥–µ–ª–∞—Ç—å –¥–µ–Ω—å <span
                    id="debug">–æ—Å–æ–±–µ–Ω–Ω—ã–º</span>.</p>
        </div>

        <div class="container mt-4" id="debug-window" style="display: none;">
            <div class="card border-danger shadow-sm">
                <div class="card-header bg-danger text-white">
                    –¢–µ—Å—Ç —Ä–∞–∑–º–µ—Ä–æ–≤ Mini App
                </div>
                <div class="card-body text-center">
                    <div class="row">
                        <div class="col-6">
                            <p class="small text-muted mb-1">–®–∏—Ä–∏–Ω–∞</p>
                            <h4 id="js-width">0px</h4>
                        </div>
                        <div class="col-6">
                            <p class="small text-muted mb-1">–í—ã—Å–æ—Ç–∞</p>
                            <h4 id="js-height">0px</h4>
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-light rounded">
                        <small class="text-secondary">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</small>
                        <div id="js-platform" class="fw-bold">–û–ø—Ä–µ–¥–µ–ª—è–µ–º...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="chose-employee" style="display: none;">
        <header class="screen-header">
            <h2 class="screen-title">1 / 3 –í—ã–±–µ—Ä–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</h2>
            <i class="fa-solid fa-xmark" data-screen-go="main"></i>
        </header>
        <div class="employee-cards-container">
            <!-- <div class="employee-card">
                <img src="./assets/img/avatar.png" alt="Employee">
                <h3>–ü–∞–≤–µ–ª –ê–Ω—Ç–∏–ø–æ–≤</h3>
                <p>Owner</p>
            </div> -->

        </div>
    </div>
    <div id="chose-img" style="display: none;">
        <header class="screen-header">
            <h2 class="screen-title">2 / 4 –í—ã–±–µ—Ä–µ—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É</h2>
            <i class="fa-solid fa-xmark" data-screen-go="main"></i>
        </header>
        <div class="swiper-container">
            <div class="swiper-wrapper">
                <!-- <div class="swiper-slide"><img src="./assets/img/v/1 –í–∞–ª–µ–Ω—Ç–∏–∫–∞.png" alt=""></div> -->
                <!-- <div class="swiper-slide" id="load-image">
                    <div class="upload-container">
                        <input type="file" id="valentine-image-input" accept="image/*" style="display: none;">

                        <button type="button" class="btn-upload" id="trigger-upload">
                            <span class="icon">üì∏</span>
                            <span class="text">–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ</span>
                        </button>

                        <div id="image-preview-container" class="preview-hidden">
                            <img id="image-preview" src="" alt="–í–∞—à–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞">
                            <button type="button" id="remove-image" class="btn-remove">&times;</button>
                        </div>
                    </div>
                </div> -->
            </div>
            <div class="swiper-pagination"></div>
        </div>
        <div class="swiper-controls">
            <div class="heart-button-prev">
                <i class="fa-solid fa-heart"></i>
            </div>
            <div class="heart-button-next">
                <i class="fa-solid fa-heart"></i>
            </div>
        </div>
    </div>
    <div id="write-text" style="display: none;">
        <header class="screen-header">
            <h2 class="screen-title">3 / 4 –ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç</h2>
            <i class="fa-solid fa-xmark" data-screen-go="main"></i>
        </header>
        <div class="text-wrapper">
            <textarea placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏ (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤)"></textarea>
        </div>
    </div>
    <div id="sending-privacy" style="display: none;">
        <header class="screen-header">
            <h2 class="screen-title">4 / 4 –ê–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å</h2>
            <i class="fa-solid fa-xmark" data-screen-go="main"></i>
        </header>
        <div class="container">
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É</p>
            <div class="privacy-container">
                <!-- <h3 class="title">–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É?</h3> -->
                <div class="options-grid">
                    <label class="option-card">
                        <input type="radio" name="senderMode" value="public" checked id="modePublic">
                        <div class="card-content">
                            <span class="icon">
                                <img src="" alt="" class="sender-avatar avatar-ratio">
                            </span>
                            <span class="label-text">–û—Ç –º–æ–µ–≥–æ –∏–º–µ–Ω–∏</span>
                            <span class="sub-text">–ü–æ–ª—É—á–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç, –∫—Ç–æ –≤—ã</span>
                        </div>
                    </label>

                    <label class="option-card">
                        <input type="radio" name="senderMode" value="anonymous" id="modeAnonymous">
                        <div class="card-content">
                            <span class="icon">
                                <img src="{%static 'valentine_day/img/silens.png'%}" alt="">
                            </span>
                            <span class="label-text">–ê–Ω–æ–Ω–∏–º–Ω–æ</span>
                            <span class="sub-text">–í–∞—à–µ –∏–º—è –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç–æ</span>
                        </div>
                    </label>
                </div>

                <div id="signatureSection" class="signature-hidden">
                    <label for="signatureInput" class="input-label">–í–∞—à–∞ –ø–æ–¥–ø–∏—Å—å:</label>
                    <input type="text" id="signatureInput" class="custom-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä –¢–≤–æ–π —Ç–∞–π–Ω—ã–π –ø–æ–∫–ª–æ–Ω–Ω–∏–∫">
                </div>
            </div>
        </div>
    </div>
    <div id="check-form" style="display: none;">
        <header class="screen-header">
            <h2 class="screen-title">–ü—Ä–æ–≤–µ—Ä–∫–∞</h2>
            <i class="fa-solid fa-xmark" data-screen-go="main"></i>
        </header>
        <div class="container">
            <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤—Å–µ –ª–∏ –≤—ã –∑–∞–ø–æ–ª–Ω–∏–ª–∏ –≤–µ—Ä–Ω–æ</p>
            <img id="check-img" src="" alt="" class="w-full">
            <p id="check-text"></p>
            <h3>–û—Ç–ø—Ä–∞–≤–∫–∞: <span class="sender-name"></span></h3>
            <h3 class="recipient-data">–ö–æ–º—É: <img class="avatar-ratio" id="check-recipient-avatar" src="" alt=""><span id="check-recipient-name"></span></h3>
        </div>
    </div>
    <div id="my-valentines" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="main"></i>
            <h2 class="screen-title">–ú–æ–∏ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏</h2>
            <span></span>
        </header>
        <div class="container">
            <h3><i class="fa-solid fa-circle-info"></i>
                –í–∞—à–∏ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã <br>13 —Ñ–µ–≤—Ä–∞–ª—è –≤ 14:00</h3>
            <ul class="valentine-list">
                <!-- <li class="valentine-item">
                    <img class="avatar" src="./assets/img/avatar.png" alt="Avatar">
                    <span class="name">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</span>
                    <i class="fa-solid fa-eye view-icon my-valentine-detail"></i>
                    <i class="fa-solid fa-trash my-valentine-delete"></i>
                </li> -->
            </ul>
        </div>
    </div>
    <div id="my-valentine-detail" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="my-valentines-list"></i>
        </header>
        <div class="container">
            <img class="valentine-img" src="" alt="" style="width: 100%;">
            <p class="valentine-text"></p>
            <h3>–ü–æ–ª—É—á–∞—Ç–µ–ª—å: <span class="valentine-recipient-name"></span></h3>
            <h3>–û—Ç–ø—Ä–∞–≤–∫–∞: <span class="valentine-sender-name"></span></h3>
        </div>
    </div>
    <div id="my-valentine-delete" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="my-valentines-list"></i>
        </header>
        <div class="container">
            <p>–•–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫—É?</p>
            <img src="{%static 'valentine_day/img/delete.png' %}" alt="">
        </div>
    </div>
    <div id="bottom-block" class="bottom-block">
        <button id="next-btn">
            <span class="btn-text">
                –î–∞–ª–µ–µ
            </span>
            <i class="fa-solid fa-angle-right"></i>
        </button>
    </div>
    <div id="received-valentines" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="main"></i>
            <h2 class="screen-title">–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏</h2>
            <span></span>
        </header>
        <div class="container wait" style="display: none;">
            <h3>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∏ –ø—Ä–∏–¥—É—Ç 13–≥–æ —Ñ–µ–≤—Ä–∞–ª—è –≤ 14:00 (–º–∫—Å)</h3>
            <img src="{%static 'valentine_day/img/wait.png'%}" alt="">
        </div>
        <div class="container empty" style="display: none;">
            <h2>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é –Ω–∏—á–µ–≥–æ –Ω–µ—Ç</h2>
            <img src="{%static 'valentine_day/img/delete.png' %}" alt="">
        </div>
        <div class="container">
            <ul class="valentine-list"></ul>
        </div>
    </div>
    <div id="received-valentines-detail" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="received-valentines-list"></i>
        </header>
        <div class="container">
            <img class="valentine-img" src="" alt="" style="width: 100%;">
            <p class="valentine-text"></p>
            <h3 class="recipient-info">–û—Ç:
                <img class="avatar avatar-ratio" src="" alt="">
                <span class="valentine-recipient-name">–ò–Ω–∫–æ–≥–Ω–∏—Ç–æ</span>
            </h3>
        </div>
    </div>
    <div id="error-screen" style="display: none;">
        <header class="screen-header">
            <i class="fa-solid fa-chevron-left" data-screen-go="main"></i>
        </header>
        <div class="container">
            <h2>–û—à–∏–±–∫–∞</h2>
            <p id="error-message"></p>
            <img src="{%static 'valentine_day/img/delete.png' %}" alt="">
        </div>
    </div>
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        const CSRF_TOKEN = "{{ csrf_token }}";
        const BASE_URL = "//{{ request.get_host }}/valentine-day";
        const apiClient = new ApiClient(BASE_URL)
        const appContext = {
            ui: {
                bottomBar: new BottomBar(),
            },
            api: {
                client: apiClient,
            },
            collections: {},
            formState: new ValentineFormState(),
            defaults: {
                avatar: "{% static 'valentine_day/img/avatar.png' %}",
                heicPrev: "{% static 'valentine_day/img/HEIC.png' %}",
            }
        }

        appContext.collections.employees = new EmployeeCollection(apiClient, appContext)
        appContext.collections.my_valentines = new MyValentineCollection(apiClient, appContext)
        appContext.collections.valentineImages = new ValentineImageCollection(apiClient, appContext)
        appContext.collections.received_valentines = new ReceivedValentineCollection(apiClient, appContext)

        const router = new ScreenRouter()
        const screens = [
            ["main", MainScreen],
            ["about", AboutScreen],
            ["preload", PreLoadScreen],
            ["error-screen", ErrorMessageScreen],
            ["my-valentines-list", MyValentineListScreen],
            ["my-valentines-detail", MyValentineDetailScreen],
            ["my-valentines-delete", MyValentineDeleteScreen],
            ["received-valentines-list", ReceivedValentineListScreen],
            ["received-valentines-detail", ReceivedValentineDetailScreen],
            ["form/chose-employee", EmployeeScreen],
            ["form/chose-image", ChoseImageScreen],
            ["form/write-text", WriteTextScreen],
            ["form/sending-privacy", SendingPrivacyScreen],
            ["form/check", CheckFormScreen],
        ]

        screens.forEach(([route, ScreenClass]) => {
            router.register(route, new ScreenClass(router, appContext))
        })

        const app = new ValentineApp(appContext, router, tg)
        app.start()
    </script>
    <script>
        document.getElementById("debug").addEventListener("click", function () {
            document.getElementById("debug-window").style.display = "block"
        })
        function updateAppMetrics() {
            const widthEl = document.getElementById('js-width');
            const heightEl = document.getElementById('js-height');
            const platformEl = document.getElementById('js-platform');
            const w = window.innerWidth;
            const h = window.innerHeight;
            if (widthEl) widthEl.innerText = w + 'px';
            if (heightEl) heightEl.innerText = h + 'px';
            if (platformEl) {
                if (window.Telegram && window.Telegram.WebApp) {
                    const platform = window.Telegram.WebApp.platform;
                    platformEl.innerText = platform.toUpperCase();
                    document.body.classList.toggle('is-desktop', platform === 'tdesktop' || platform === 'macos');
                } else {
                    platformEl.innerText = '–ë—Ä–∞—É–∑–µ—Ä (–≤–Ω–µ Telegram)';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand(); 
            }
            updateAppMetrics();
            window.addEventListener('resize', updateAppMetrics);
        });
    </script>
</body>

</html>